parameters:
  context: ''
  image: ''
  repository: ''
  serviceConnection: ''

steps:
- task: Docker@2
  displayName: Docker Build and Push ${{ parameters.image }}
  inputs:
    command: buildAndPush
    buildContext: ${{ parameters.context }}
    Dockerfile: "${{ parameters.context }}/Dockerfile"
    repository: rochambot/${{ parameters.image }}
    containerRegistry: ${{ parameters.serviceConnection }}
    tags: $(Build.BuildNumber)

- task: HelmDeploy@0
  displayName: Helm Package ${{ parameters.image }}
  inputs:
    command: package
    chartPath: charts/${{ parameters.image }}
    destination: $(Build.ArtifactStagingDirectory)
    version: $(Build.BuildNumber)
    save: false
